{{#if isAuth}}
{{> navBar profilePic = profilePic isAuth = isAuth}}
{{/if}}
{{#unless isAuth}}
{{> navBar profilePic =
'https://media.istockphoto.com/vectors/anonymity-concept-icon-in-neon-line-style-vector-id1259924572?k=20&m=1259924572&s=612x612&w=0&h=Xeii8p8hOLrH84PO4LJgse5VT7YSdkQY_LeZOjy-QD4='}}
{{/unless}}
<style>
  .bottom-post {
    height: 50px;
    display: flex;
    font-weight: bold;
    justify-content: center;
    align-items: center;
    width: 100%;
  }

  @media screen and (max-width: 991px) {
    .navbar__ {
      display: none;
    }
    .xsc {
      border-radius: 30px;
    }
  }

.back {
  height: 56px;
  background-color: #fff;
}

  #house {
    color: #D1DBDF;
  }
  
  
</style>

<div class="posts_cards">
<div class="top d-lg-none d-flex">
    <div class="container bg-white">
      <div class="row justify-content-between">
        <div class="col-5" style="margin-left:20px;font-size:40px">
            <button onclick="history.back()" style="background: none;border:none">  <i class="fa-solid fa-arrow-left"></i></button>
        </div>
        <div class="col-5" style="display: flex;justify-content: end;align-items: center;font-size: 25px;font-weight:bold;margin-right:25px" >
        </div>
      </div>
    </div>
</div>
  <div class="container-fluid px-0 px-lg-3 mt-lg-0 mt-3" style="overflow:hidden auto">
    {{!-- {{#each fields}}
      Title : {{title}} <br>
      Disc : {{disc}} <br>
      <img src='{{img}}'> <br>
    {{/each}} --}}
    <div class="grid_postsx row justify-content-center align-items-center  " style="gap: 3.5rem;">


      <div class="row "style="gap:5rem;display:flex;justify-content:end;padding-left:0px;padding-right:0px">

      <div class="col-12 col-lg-7 bg-white p-3 xsc">
        <div class="post_boxx px-0 px-lg-3" data-type="art">
          {{#each fields}}

          <h2>{{title}}</h2>
          <div class="index_image">
            <img src="{{img}}" style="object-fit: scale-down;" alt="">
          </div>
          <br>
          <div class="desc">
            <p style="font-size:30px;">{{disc}}</p>
          </div>
          <div class="top">
            <div class="items">
              {{#if isDeletable}}
              <div class="item delI"
                onclick='axios.delete(`/deletePost`,{data:{postNum:"{{postNum}}"}});location.href = "/profile"'><i
                  class="fa-solid fa-trash-can"></i></div>
              {{/if}}
              {{#unless isDeletable}}
              <div class="item sned" onclick="location.href = `/chatRoom?user={{postUser}}&redirect=true`"><i
                  class="fas fa-comment"></i></div>
                  {{#if paypal}}
                  <div class="item donate" onclick="
                      location.href = 'https://www.paypal.com/webscr?cmd=_xclick&item_name=Donation&amount=&currency_code=USD&business={{paypal}}'"><i class="fa-solid fa-money-bill"></i></div>
                  {{/if}}
              {{/unless}}
              {{#if isLiked}}
              <div class="item star" id="{{postNum}}-id" onclick="removeLike()">
                <i style="color: red;" class="fa-solid fa-heart-broken"></i>
              </div>
              {{/if}}
              {{#unless isLiked}}
              <div class="item star" id="{{postNum}}-id" onclick="addLike()">
                <i style="color: red;" class="fa-solid fa-heart"></i>
              </div>
              {{/unless}}
            </div>
          </div>
          <div class="bottom">
            <div class="UserDetails" style="cursor:pointer"
              onclick="window.location.href = '/profile?user={{postUser}}'">
              <div class="name_time">
              </div>
            </div>
            <div class="title_of_post">
              <div class="post_title">
                <div class="post__name">
                  <h5 title="Post Nmae">
                </h5>
                </div>
              </div>
            </div>
          </div>
              {{/each}}
      </div>
        

      </div>
        <div class="col-12 col-lg-4  vh-100 xc " style="background:#fff;" >
        <div class="row" >
          <div class="col-12">
            <div class="cardxx p-3">
                <div class="d-flex flex-row align-items-center">
                    <div class="profile_image d-flex align-items-center justify-content-center rounded-circle overflow-hidden ">
                      <img class="w-100 h-100 fit_obj"   onclick="window.location.href = '/profile?user={{postUser}}'"  src="{{posterProfilePic}}" alt="">
                    </div>
                    <div class="text_protex ms-2">
                      <div class="protex_name d-flex align-items-center gap-1">
                        <h4 class="mb-0"  onclick="window.location.href = '/profile?user={{user}}'">{{postUser}}</h4>
                        {{#if verified}}
                        <i class="fa-solid fa-circle-check verified_user"></i>
                                          {{/if}}
                      </div>
                      <b class="protex_date">{{date}}</b>
                    </div>
                </div>
            </div>
          </div>
          <div class="col-12">
            <div class="post-info">
        <div>
          <h2></h2>
          <p>{{likes}} Likes | {{commentsQty}} Comments</p>
        </div>
      </div>
          </div>
          <div class="col-12">
            <div class="cardxx mt-4" data-type="art">
              <div class="topx py-2">
                <h2>Opinions</h2>
              </div>
                  <div class="flex-grow-0 py-3 px-3 ">
                <div class="inp-f">
                    <input name="comment" class="comment_input" id="comment-inp" rows="1" onkeyup="if(event.key === 'Enter') comment('{{postNum}}','{{postUser}}')"
                  placeholder="Enter your Opinions"></input>
                <button type="submit" class="sub-chat" onclick="comment('{{postNum}}','{{postUser}}')" > Send</button>
                </div>
              </div>
              <div class="comments_container">
                <div class="comment_c">
                  {{#each commentsArray}}
                  <div class="comment_item">
                    <div class="d-flex flex-warp align-items-center justify-content-between pe-3r">
                      <div class="item_d d-flex align-items-center gap-1">
                        <div class="img_container">
                          {{#if verified}}
                          <i class="fa-solid fa-circle-check verified_user"></i>
                          {{/if}}
                          <img src="{{profilePic}}" onclick="window.location.href = '/profile?user={{user}}'">
                        </div>
                        <div class="username_post" onclick="window.location.href = '/profile?user={{user}}'">{{user}}
                        </div>
                      </div>
                      <div class="items_tools">
                        {{#if own}}
                        <i class="fa-solid fa-trash-can delete_comment_button text-danger me-3" title="Delete Comment"
                          onclick="deleteComment('{{commentNum}}','{{user}}')"></i>
                        {{/if}}
                      </div>
                    </div>
                    <div class="comment_post">
                      {{content}}</div>
                  </div>
                  {{/each}}
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      </div>
    </div>
  </div>
</div>
<noscript id="data" postNum="{{postNum}}" postUser="{{postUser}}" paypal="{{paypal}}"></noscript>

<script>
    newPageTitle = 'View post | Otnem - Share your project with the world';
    document.querySelector('title').textContent = newPageTitle;
  async function deletePost(postNum) {
    await axios.delete(`/deletePost`, { data: { postNum: postNum } })
    location.reload()
  }
  async function comment(postNum, postUser) {
    let comment = $('#comment-inp').val()
    let res = await axios.post('/comment', {
      comment: comment,
      postNum: postNum,
      postUser: postUser
    })
    if (res.data.startsWith('<!DOCTYPE html>'))
      location.href = '/login'
    else
      location.reload()
  }
  async function deleteComment(commentNum, commentUser) {
    let postNum = $("#data").attr('postNum')
    let postUser = $("#data").attr('postUser')
    let res = await axios.delete('/deleteComment', { data: { commentNum: commentNum, postNum: postNum, postUser: postUser, commentUser: commentUser } })
    if (typeof res.data == 'string' && res.data.startsWith('<!DOCTYPE html>'))
      location.href = '/login'
    location.reload()
  }
  async function addLike() {
    let postNum = $("#data").attr('postNum')
    let user = $("#data").attr('postUser')
    if (!$('#loggedIn').attr('isAuth'))
      location.href = '/login'
    await axios.post('/addLike', { user, postNum })
    location.href = `/postPreview?postNum=${postNum}&&user=${user}`
  }
  async function removeLike() {
    let postNum = $("#data").attr('postNum')
    let user = $("#data").attr('postUser')
    if (!$('#loggedIn').attr('isAuth'))
      location.href = '/login'
    await axios.post('/removeLike', { user, postNum })
    location.href = `/postPreview?postNum=${postNum}&&user=${user}`
  }
</script>   